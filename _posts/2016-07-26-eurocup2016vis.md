---
layout: post
title: Euro Cup 2016 Visualization
subtitle: Varieties of Bar plots
fb-img: https://github.com/loiyumba/loiyumba.github.io/blob/master/img/uefa2016/plot1.png
---

The group matches are not exciting to me. What excites me is the knock-out games! I started watching Euro Cup 2016 from quarter finals. 
Due to different time zone, we always have to stay awake almost all night to watch the game. I predicted Germany to win this Euro Cup,
however they were defeated by France. All my friends were predicting France to win the final, and looking at the game, it was obvious France 
will win. France played brilliantly but they just couldn't score a goal to take away the cup. I would say that night, lady luck was sitting on
Portugal.   

Apart from games, I was also interested in game statistics. I have waited for the tournament to get over so that I can see the final statistics.  

Getting and Cleaning Data
--------
The data is posted on official UEFA  [site](http://www.uefa.com/uefaeuro/season=2016/statistics/index.html). And to transfer the data table 
posted on the website to R, I have used `rvest` package.    

```r
library(rvest)
```   
And to copy the data table from the site, the code goes like this   

```r
attempts <- read_html("http://www.uefa.com/uefaeuro/season=2016/statistics/round=2000448/teams/category=attacking/kind=attempts/index.html")

attemptsData <- attempts %>% 
  html_nodes("table") %>% 
  .[[1]] %>% 
  html_table()
```   
First, we have to save the url page where the table is displayed. Then using rvest function html_nodes("table") and then .[[1]] for table
1 and then html_table(), we can easily copy the table. In fact, the page has only one table. If there were two tables and we wanted both
then we would have used .[[2]] to transfer table number 2. For more detail, please read `rvest` package info.  

Once the data is successfully transfered to R, we can do some data exploration like   

```r
str(attemptsData)
head(attemptsData)
```      

While looking at the data, I have noticed that some unwanted characters appeared on the Team name column. In order to remove unwanted
character, I have used base R function **substr** and **str_trim** from `stringr` package.    

```r
attemptsData$Name <- substr(attemptsData$Name, 6, 70)
attemptsData$Name <- str_trim(attemptsData$Name, side = "left")
```   

**substr** function removed the first 5 unwanted characters and left with spaces on the left side. While the country/team names are on the right side, I have used **str_trim(, side = "left")** to remove all the spaces on the left which also made other unwanted characters go.    

Once the data is cleaned, I have saved the data in the local disk.  

```r
write.csv(attemptsData, "attempts.csv", row.names = FALSE)
```   

Visualization
---------   

Load the `ggplot2` package.

```r
library(ggplot2)
```

Basic ggplot first    

```r
ggplot(attempts, aes(x = Name, y = Total.attempts)) +
  geom_bar(stat = "identity")
```   

[![basic]({{ site.url }}/img/uefa2016/plot1.png)]({{ site.url }}/img/uefa2016/plot1.png)   
From the above ggplot, we can't make out what's in the x-axis. The y-label is not properly named. In order to read the x-axis well, I have flipped the ggplot. I have added **###** to identify the new code of line.    

```r
ggplot(attempts, aes(x = Name, y = Total.attempts)) +
  geom_bar(stat = "identity") +
  coord_flip() ###
```   

[![flipped]({{ site.url }}/img/uefa2016/Rplot2.png)]({{ site.url }}/img/uefa2016/Rplot2.png)   

Now we can read the country/team names properly. I want to label the x-axis and y-axis appropriately. X-axis label name "Name", I will keep it empty and y-axis label name to "Attempts". Also, add title to the ggplot.

```r
ggplot(attempts, aes(x = Name, y = Total.attempts)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  ggtitle("Total Attempts by Team in EuroCup 2016") + ###
  labs(x = "", y = "Attempts") ###
```   

[![title]({{ site.url }}/img/uefa2016/Rplot3.png)]({{ site.url }}/img/uefa2016/Rplot3.png)    

Now I want to display the attempts made by country/team on their respective bar. 

```r
ggplot(attempts, aes(x = Name, y = Total.attempts)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label = Total.attempts), hjust = -0.2) + ###
  coord_flip() +
  ggtitle("Total Attempts by Team in EuroCup 2016") +
  labs(x = "", y = "Attempts")
```    

[![values]({{ site.url }}/img/uefa2016/Rplot4.png)]({{ site.url }}/img/uefa2016/Rplot4.png)     

Change the colour of bar and remove the grey background. To see the colours available in R, we can run **colors()** in the console and it will display all the colours name.

```r
ggplot(attempts, aes(x = Name, y = Total.attempts)) +
  geom_bar(stat = "identity", fill = "lavender") + ###
  geom_text(aes(label = Total.attempts), hjust = -0.2) + 
  coord_flip() +
  ggtitle("Total Attempts by Team in EuroCup 2016") +
  labs(x = "", y = "Attempts") +
  theme_bw() ###
```   

[![color]({{ site.url }}/img/uefa2016/Rplot5.png)]({{ site.url }}/img/uefa2016/Rplot5.png)   

Let's reorder the bar in descending order as per attempts made by country/team. For this we need to manipulate data little bit. We arrange the variable _Total.attempts_ in descending order and also use **reorder()** in ggplot.   

```r
attempts <- arrange(attempts, desc(Total.attempts))

ggplot(attempts, aes(x = reorder(Name, Total.attempts), y = Total.attempts)) + ###
  geom_bar(stat = "identity", fill = "lavender") +
  geom_text(aes(label = Total.attempts), hjust = -0.2) +
  coord_flip() +
  ggtitle("Total Attempts by Team in EuroCup 2016") +
  labs(x = "", y = "Attempts") +
  theme_bw()
```   

[![order]({{ site.url }}/img/uefa2016/Rplot6.png)]({{ site.url }}/img/uefa2016/Rplot6.png)    

Now I want all the grid lines go.

```r
ggplot(attempts, aes(x = reorder(Name, Total.attempts), y = Total.attempts)) +
  geom_bar(stat = "identity", fill = "lavender") +
  geom_text(aes(label = Total.attempts), hjust = -0.2) +
  coord_flip() +
  ggtitle("Total Attempts by Team in EuroCup 2016") +
  labs(x = "", y = "Attempts") +
  theme(panel.background = element_blank()) ###
```   

[![grid]({{ site.url }}/img/uefa2016/Rplot7.png)]({{ site.url }}/img/uefa2016/Rplot7.png)   

Okay, without the x-axis the plot doesn't look good to me. So I have added an x-axis line with the same colour as bar.

```r
ggplot(attempts, aes(x = reorder(Name, Total.attempts), y = Total.attempts)) +
  geom_bar(stat = "identity", fill = "lavender") +
  geom_text(aes(label = Total.attempts), hjust = -0.2) +
  coord_flip() +
  ggtitle("Total Attempts by Team in EuroCup 2016") +
  labs(x = "", y = "Attempts") +
  theme(axis.line.x = element_line(size = .8, colour = "lavender"), ###
        panel.background = element_blank())
```   

[![axisline]({{ site.url }}/img/uefa2016/Rplot8.png)]({{ site.url }}/img/uefa2016/Rplot8.png)  



